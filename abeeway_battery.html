<!DOCTYPE html>
<html>
<head>
    <title>Abeeway battery life-time calculator</title>
    <style>
        html {
            margin: 10px;
        }
        .flexcontainer {
            display: flex;
            flex-flow: row wrap;
            justify-content: flex-start;
            align-items: stretch;
            align-content: flex-start
        }
        .flexitem { 
            flex-flow: 1 1 1;
            padding: 4px;
            box-sizing: border-box;
            min-width: 200px;
        }
        input[type="text"], input[type="number"], select, button, textarea {
            width: 100%;
            padding: 2px 3px 2px 3px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        textarea {
            width: 392px;
            height: 150px;
            padding: 2px 3px 2px 3px;
            margin-bottom: 10px;
            box-sizing: border-box;
        } 
    </style>
</head>
<body>
    <h1>Abeeway battery life-time calculator</h1>

    <div class="flexcontainer">
        <fieldset class='flexcontainer flexitem'>
            <legend>General config params:</legend>

            <div class='flexitem'>
                <label for="product">Product:</label><br />
                <select id="product" name="product">
                    <option value="industrial">Industrial Tracker</option>
                    <option value="compact">Compact Tracker</option>
                    <option value="micro">Microtracker</option>
                    <option value="smart_badge" selected>Smart Badge</option>
                </select><br />

                <label for="tx_power">Tx power:</label><br />
                <select id="tx_power" name="tx_power">
                    <option value="_14dBm_">14dBm</option>
                    <option value="_17dBm_">17dBm</option>
                    <option value="_19dBm_">19dBm</option>
                </select><br />

                <label for="sf">Spreading Factor:</label><br />
                <select id="sf" name="sf">
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10" selected>10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                </select><br />
            </div>

            <div class='flexitem'>
                <label for="nof_msg_repetition">N. of times every msg sent:</label><br />
                <select id="nof_msg_repetition" name="nof_msg_repetition">
                    <option value=1 selected>1</option>
                    <option value=2>2</option>
                    <option value=3>3</option>
                    <option value=4>4</option>
                </select><br />
                
                <label for="accelerometer_on">Accelerometer On:</label>
                <input type="checkbox" id="accelerometer_on" name="accelerometer_on" checked><br />
            </div>

        </fieldset>

        <fieldset class='flexitem'>
            <legend>Custom messages:</legend>

            <label for="custom_msg_nof_msg_per_day">Num. of msg/day:</label><br />
            <input type="number" min="0" id="custom_msg_nof_msg_per_day" name="custom_msg_nof_msg_per_day" value="0"><br />

            <label for="custom_msg_payl_len">Payload length [byte]:</label><br />
            <input type="number" min="0" id="custom_msg_payl_len" name="custom_msg_payl_len" value="17">

        </fieldset>

        <fieldset class='flexitem'>
            <legend>Heartbeat messages:</legend>

            <label for="heartbeat_nof_msg_per_day">Num. of msg/day:</label><br />
            <input type="number" min="0" id="heartbeat_nof_msg_per_day" name="heartbeat_nof_msg_per_day" value="0"><br />

        </fieldset>

        <fieldset class='flexitem'>
            <legend>GPS location updates:</legend>

            <label for="gps_nof_msg_per_day">Num. of update/day:</label><br />
            <input type="number" min="0" id="gps_nof_msg_per_day" name="gps_nof_msg_per_day" value="0"><br />

            <label for="gps_ttff">Time to first fix [s]:</label><br />
            <input type="number" min="0" id="gps_ttff" name="gps_ttff" value="49"><br />

            <label for="gps_conv_time">GPS convergence time [s]:</label><br />
            <input type="number" min="0" id="gps_conv_time" name="gps_conv_time" value="90"><br />

        </fieldset>

        <fieldset class='flexitem'>
            <legend>AGPS location updates:</legend>

            <label for="agps_nof_msg_per_day">Num. of update/day:</label><br />
            <input type="number" min="0" id="agps_nof_msg_per_day" name="agps_nof_msg_per_day" value="0"><br />

            <label for="agps_on_time">AGPS on time [s]:</label><br />
            <input type="number" min="0" id="agps_on_time" name="agps_on_time" value="8"><br />

            <label for="agps_nof_satellites">Num. of satellites:</label><br />
            <select id="agps_nof_satellites" name="agps_nof_satellites">
                <option value=1>1</option>
                <option value=2>2</option>
                <option value=3>3</option>
                <option value=4>4</option>
                <option value=5 selected>5</option>
            </select>

        </fieldset>

        <fieldset class='flexitem'>
            <legend>WiFi location updates:</legend>

            <label for="wifi_nof_msg_per_day">Num. of update/day:</label><br />
            <input type="number" min="0" id="wifi_nof_msg_per_day" name="wifi_nof_msg_per_day" value="0"><br />

            <label for="wifi_nof_bssid">Num. of BSSID/msg:</label><br />
            <select id="wifi_nof_bssid" name="wifi_nof_bssid">
                <option value=1>1</option>
                <option value=2>2</option>
                <option value=3>3</option>
                <option value=4 selected>4</option>
            </select>

        </fieldset>

        <fieldset class='flexitem'>
            <legend>BLE location updates:</legend>

            <label for="ble_nof_msg_per_day">Num. of update/day:</label><br />
            <input type="number" min="0" id="ble_nof_msg_per_day" name="ble_nof_msg_per_day" value="0"><br />

            <label for="ble_nof_beaconid">Num. of beacon ID/msg:</label><br />
            <select id="ble_nof_beaconid" name="ble_nof_beaconid">
                <option value=1>1</option>
                <option value=2>2</option>
                <option value=3>3</option>
                <option value=4 selected>4</option>
            </select><br />

        </fieldset>

        <fieldset class='flexitem'>
            <legend>Custom BLE usage:</legend>

            <label for="custom_ble_usage_time_per_day">Usage per day [hour]:</label><br />
            <input type="number" min="0" id="custom_ble_usage_time_per_day" name="custom_ble_usage_time_per_day" value="0"><br />
            <label for="custom_ble_operation">BLE operation:</label><br />
            <select id="custom_ble_operation" name="custom_ble_operation">
                <option value="fast_adv">Fast advertisement (2s)</option>
                <option value="slow_adv">Slow advertisement (10s)</option>
                <option value="connected">Connected (2s)</option>
                <option value="slow_scan">Slow BLE scan (30sec)</option>
                <option value="fast_scan">Fast BLE scan (8sec)</option>
            </select><br />

        </fieldset>

        <!-- Will be implemented soon!!! -->
        <!--
        <fieldset class='flexitem'>
            <legend>Proximity detection:</legend>

            <label for="proximity_usage_time_per_day">Usage per day [hour]:</label><br />
            <input type="number" min="0" id="proximity_usage_time_per_day" name="proximity_usage_time_per_day" value="0"><br />

            <label for="proximity_alarms_per_day">Num. of alarms per day :</label><br />
            <input type="number" min="0" id="proximity_alarms_per_day" name="proximity_alarms_per_day" value="10"><br />

            <label for="proximity_warnings_per_day">Num. of warnings per day :</label><br />
            <input type="number" min="0" id="proximity_warnings_per_day" name="proximity_warnings_per_day" value="20"><br />

        </fieldset>
        -->

        <fieldset class='flexitem'>

            <legend>Calculation:</legend>

            <button onClick = "calculate()">Calculate</button><br />

            <label for="result">Result:</label><br />
            <textarea id="result"></textarea>

        </fieldset>

    </div>

</body>

<script>

    /*********************************************************************/
    /***** GUI SCRIPTS                                               *****/
    /*********************************************************************/

    function calculate() {

        let input = {

            product:                document.getElementById('product').value,                       // industrial|compact|micro|smart_badge
            tx_power:               document.getElementById('tx_power').value,                      // _14dBm_|_17dBm_|_19dBm
            sf:                     document.getElementById('sf').value,                            // 7|8|9|10|11|12
            nof_msg_repetition:     document.getElementById('nof_msg_repetition').value,
            accelerometer_on:       document.getElementById('accelerometer_on').checked,

            custom_msg: {
                nof_msg_per_day:    document.getElementById('custom_msg_nof_msg_per_day').value,
                payl_len:           document.getElementById('custom_msg_payl_len').value,               // [bytes]
            },
            heartbeat: {
                nof_msg_per_day:    document.getElementById('heartbeat_nof_msg_per_day').value,
            },
            gps: {
                nof_msg_per_day:    document.getElementById('gps_nof_msg_per_day').value,
                ttff:               document.getElementById('gps_ttff').value,                      // [s]
                conv_time:          document.getElementById('gps_conv_time').value,                 // [s]
            },
            agps: {
                nof_msg_per_day:    document.getElementById('agps_nof_msg_per_day').value,
                on_time:            document.getElementById('agps_on_time').value,                  // [s]
                nof_satellites:     document.getElementById('agps_nof_satellites').value,
            },
            wifi: {
                nof_msg_per_day:    document.getElementById('wifi_nof_msg_per_day').value,
                nof_bssid:          document.getElementById('wifi_nof_bssid').value,                
            },
            ble: {
                nof_msg_per_day:    document.getElementById('ble_nof_msg_per_day').value,
                nof_beaconid:       document.getElementById('ble_nof_beaconid').value,
            },
            custom_ble: {
                usage_time_per_day: document.getElementById('custom_ble_usage_time_per_day').value, // fast_adv|slow_adv|connected|fast_scan|slow_scan
                operation:          document.getElementById('custom_ble_operation').value,
            },
            
            // The following parameters will be implemented soon!!! 
            /*
            proximity: {
                usage_time_per_day: document.getElementById('proximity_usage_time_per_day').value,
                alarms_per_day:     document.getElementById('proximity_alarms_per_day').value,
                warnings_per_day:   document.getElementById('proximity_warnings_per_day').value,
            }
            */

        };

        let result = calculate_battery_life_time(input);
        // document.getElementById('result').value = JSON.stringify(result, null, 2);

        let result_text = "Battery life time: " + result.battery_life_time + " days\n";
        result_text += "Energy distribution:\n";
        if (result.current_distribution.custom_msg > 0) { 
            result_text += "  Custom msg: " + result.current_distribution.custom_msg + " %\n"; 
        }
        if (result.current_distribution.heartbeat > 0) { 
            result_text += "  Heartbeat: " + result.current_distribution.heartbeat + " %\n"; 
        }
        if (result.current_distribution.gps > 0) { 
            result_text += "  GPS: " + result.current_distribution.gps + " %\n"; 
        }
        if (result.current_distribution.agps > 0) { 
            result_text += "  AGPS: " + result.current_distribution.agps + " %\n"; 
        }
        if (result.current_distribution.wifi > 0) { 
            result_text += "  WiFi: " + result.current_distribution.wifi + " %\n"; 
        }
        if (result.current_distribution.ble > 0) { 
            result_text += "  BLE: " + result.current_distribution.ble + " %\n"; 
        }
        if (result.current_distribution.custom_ble > 0) { 
            result_text += "  Custom BLE: " + result.current_distribution.custom_ble + " %\n"; 
        }
        if (result.current_distribution.accelerometer > 0) { 
            result_text += "  Accelerometer: " + result.current_distribution.accelerometer + " %\n"; 
        }
        if (result.current_distribution.quiesent_and_battery_leakage > 0) { 
            result_text += "  Quiesent and Battery leakage: " + result.current_distribution.quiesent_and_battery_leakage + " %\n"; 
        }

        document.getElementById('result').value = result_text;






    }

</script>

<script src="abeeway_battery.js"></script>

</html>
